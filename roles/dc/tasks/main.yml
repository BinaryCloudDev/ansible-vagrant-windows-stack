---
# Joins Server to Domain and Promotes to Domain Controller

- name: Configure Internal Network settings
  script: ../../../ps-scripts/Set-IntnetSettings.ps1
- name: Join domain script
  script: "../../../ps-scripts/client-djoin.ps1 -u {{ username }} -p {{ password }} -d {{ domain }}"
  ignore_errors: yes
- name: Restart Machine 
  script: ../../../ps-scripts/restart.ps1
  ignore_errors: yes
- name: waiting for server to come back
  local_action:
    module: wait_for
    host: "{{ inventory_hostname }}"
    port: 5985
    delay: 10
    timeout: 500
    state: started
- name: Promote to Domain Controller
  script: "../../../ps-scripts/Promote-DC.ps1 -u {{ username }} -p {{ password }} -d {{ domain }}"
  ignore_errors: yes
- name: Restart Machine 
  script: ../../../ps-scripts/restart.ps1
  ignore_errors: yes
- name: waiting for server to come back
  local_action:
    module: wait_for
    host: "{{ inventory_hostname }}"
    port: 5985
    delay: 10
    timeout: 500
    state: started